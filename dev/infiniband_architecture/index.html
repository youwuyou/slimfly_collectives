<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>InfiniBand Architecture · Slimfly MPI collective optimization</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Slimfly MPI collective optimization</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../slimfly/">Slim Fly topology</a></li><li class="is-active"><a class="tocitem" href>InfiniBand Architecture</a><ul class="internal"><li><a class="tocitem" href="#Routing-on-Slim-Fly-at-CSCS"><span>Routing on Slim Fly at CSCS</span></a></li><li class="toplevel"><a class="tocitem" href="#Ethernet"><span>Ethernet</span></a></li></ul></li><li><a class="tocitem" href="../routing/">Routing</a></li><li><a class="tocitem" href="../benchmarks/">Benchmark</a></li><li><a class="tocitem" href="../performance/">Performance</a></li><li><a class="tocitem" href="../algorithm/">Algorithm</a></li><li><a class="tocitem" href="../mpitutorial/">MPI Tutorial</a></li><li><a class="tocitem" href="../trouble_shooting/">Trouble shooting</a></li><li><a class="tocitem" href="../readings/">Readings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>InfiniBand Architecture</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>InfiniBand Architecture</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/youwuyou/slimfly_collectives/blob/main/docs/src/infiniband_architecture.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="InfiniBand-Architecture"><a class="docs-heading-anchor" href="#InfiniBand-Architecture">InfiniBand Architecture</a><a id="InfiniBand-Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#InfiniBand-Architecture" title="Permalink"></a></h1><ul><li>based on Virtual Cut Through (VCT)</li></ul><blockquote><p>RDMA over InfiniBand: Package from one server at user application layer does not need to be copied into the kernel layer and the hardware layer but can be directed transported from the buffer of server 1 to HCAs and then to the buffer of server 2</p></blockquote><h2 id="Routing-on-Slim-Fly-at-CSCS"><a class="docs-heading-anchor" href="#Routing-on-Slim-Fly-at-CSCS">Routing on Slim Fly at CSCS</a><a id="Routing-on-Slim-Fly-at-CSCS-1"></a><a class="docs-heading-anchor-permalink" href="#Routing-on-Slim-Fly-at-CSCS" title="Permalink"></a></h2><p><strong>Matter of interest:</strong> Intra-subnet routing</p><p><strong>Hardware components:</strong></p><blockquote><p>Switch: A device that moves packets from one link to another of the same IB subnet (layer2)</p></blockquote><blockquote><p>Host Channel Adapter (HCA): device that terminates an IB link and executes transport-level functions and support the verbs interface</p></blockquote><blockquote><p>IB Router: A device that transports packets between different IBA subnets. (inter-subnet routing)</p></blockquote><blockquote><p>Bridge/Gateway: IB to Ethernet</p></blockquote><hr/><p><strong>Other Concepts</strong></p><blockquote><p>Virtual Lanes (VLs): Each virtual lane uses different buffers to send its packet towards the other side. VL-15 moves traffic of subnet manager specifically; VL-0-7 to move traffic, by default all data goes through VL-0. In order to provide different lane of service based on different usage, we need to map applications to specific virtual lanes.</p></blockquote><ul><li><p>Linear Forwarding Table (LFT): is indexed using the destination LID (DLID) of the packet. Helps to determine the output port of a packet at a switch.</p></li><li><p>Service Level (SL): 4-bit meta-data contained in each packet&#39;s header, used to determine the outgoing VL by a <em>SL-to-VL table</em> =&gt; thus packets can change virtual lanes at each hop, hardware with different number of virtual lanes can be used together.</p></li></ul><blockquote><p>Subnet Manager: most important entity in the network, does all configurations using parameters. Every subnet must have at least one.</p></blockquote><pre><code class="language-bash hljs">[dphpc@slimflysmw benchmarks]$ sminfo
ibwarn: [55188] mad_rpc_open_port: can&#39;t open UMAD port ((null):0)
sminfo: iberror: failed: Failed to open &#39;(null)&#39; port &#39;0&#39;
[dphpc@slimflysmw benchmarks]$ saquery -s
ibwarn: [55250] sa_get_handle: umad_open_port on port (null):0 failed
ibpanic: [55250] main: Failed to bind to the SA: Permission denied</code></pre><p>&quot;within a subnet the switches are of layer-2-switching&quot;?</p><p><strong>Addressing:</strong></p><p>i). Physical Adress: Global Unique Identifier (GUID)</p><ul><li><p>64 bits adress</p></li><li><p>persistent through reboots =&gt; no changes when rebooting</p></li><li><p>a switch has only one GUID (Port: identify by GUID of the node and the port number)</p></li></ul><p><strong>ii). L2 Switching Addressing Local Identifier (LID)</strong></p><ul><li><p>16 bits adress</p></li><li><p>used when moving traffic from one node to another node within a subnet</p></li><li><p>assigned by the <em>Subnet Manager</em> when port becomes active</p></li><li><p>Not persistent through reboots</p></li><li><p>Use the LID Mask Control (LMC) value</p></li></ul><p class="math-container">\[LMC=x \Rightarrow \text{No.}LIDs = 2^x\]</p><p>iii). Global Identifier (GID)</p><ul><li><p>layer 3 address</p></li><li><p>128 bits, a combination of the port GUID and the subnet prefix</p></li></ul><p><strong>Implementation:</strong> </p><blockquote><p>All comm unication up to and include the transport layer is specified and implemented within the <em>switches</em> and <em>Host &gt;Channel Adapters (HCAs)</em></p></blockquote><h1 id="Ethernet"><a class="docs-heading-anchor" href="#Ethernet">Ethernet</a><a id="Ethernet-1"></a><a class="docs-heading-anchor-permalink" href="#Ethernet" title="Permalink"></a></h1><p>Moving data between the InfiniBand and the Ethernet environment needs the hardware component &quot;Gateway&quot;</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../slimfly/">« Slim Fly topology</a><a class="docs-footer-nextpage" href="../routing/">Routing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 19 December 2022 11:06">Monday 19 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
