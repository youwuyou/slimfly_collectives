<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MPI Tutorial · Slimfly MPI collective optimization</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Slimfly MPI collective optimization</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../slimfly/">Slim Fly topology</a></li><li><a class="tocitem" href="../infiniband_architecture/">InfiniBand Architecture</a></li><li><a class="tocitem" href="../routing/">Routing</a></li><li><a class="tocitem" href="../benchmarks/">Benchmark</a></li><li><a class="tocitem" href="../performance/">Performance</a></li><li><a class="tocitem" href="../algorithm/">Algorithm</a></li><li class="is-active"><a class="tocitem" href>MPI Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Basics"><span>Basics</span></a></li><li><a class="tocitem" href="#Components-for-MPI-collective-communication"><span>Components for MPI collective communication</span></a></li><li class="toplevel"><a class="tocitem" href="#MPI-Tutorial"><span>MPI Tutorial</span></a></li><li><a class="tocitem" href="#Introduction-and-MPI-installation"><span>Introduction and MPI installation</span></a></li><li><a class="tocitem" href="#Blocking-point-to-point-communication"><span>Blocking point-to-point communication</span></a></li><li><a class="tocitem" href="#Groups-and-communicators"><span>Groups and communicators</span></a></li><li><a class="tocitem" href="#Collective-communication"><span>Collective communication</span></a></li></ul></li><li><a class="tocitem" href="../trouble_shooting/">Trouble shooting</a></li><li><a class="tocitem" href="../readings/">Readings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>MPI Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MPI Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/youwuyou/slimfly_collectives/blob/main/docs/src/mpitutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Open-MPI"><a class="docs-heading-anchor" href="#Open-MPI">Open MPI</a><a id="Open-MPI-1"></a><a class="docs-heading-anchor-permalink" href="#Open-MPI" title="Permalink"></a></h1><h2 id="Basics"><a class="docs-heading-anchor" href="#Basics">Basics</a><a id="Basics-1"></a><a class="docs-heading-anchor-permalink" href="#Basics" title="Permalink"></a></h2><p>The Open MPI is comprised of three main functional areas:</p><p><strong>i). Modular Component Architecture (MCA)</strong> The center of the Open MPI design, acts as the backbone component architecture that provides management to all other layers. Provide services such as accepting run-time parameters from higher-level abstractions like <code>mpirun</code> and pass parameters through the component framework to each individual module.</p><p><strong>ii). Component Frameworks</strong> Back-end component framework used to manage modules of each main functional area of Open MPI. Each framework with different policy.</p><p><strong>iii). Modules</strong> Self-contained software components, each dedicated to a single job and is composable with other modules in run-time.</p><blockquote><p>Component programming provides library developer a fine-grained, run-time, user-controlled component selection mechanism. Convinient for our development.</p></blockquote><h3 id="Setting-MCA-parameters"><a class="docs-heading-anchor" href="#Setting-MCA-parameters">Setting MCA parameters</a><a id="Setting-MCA-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-MCA-parameters" title="Permalink"></a></h3><blockquote><p>Syntax:  <code>-mca &lt;key&gt; &lt;value1, ..., valueN&gt;</code>, where the <code>&lt;key&gt;</code> specifies the MCA module to receive the <code>&lt;value&gt;</code>. This is a shortcut to set environment variables of the form <code>OMPI_MCA_&lt;key&gt;=&lt;value&gt;</code> and it overrides the parameters set in <code>mca-params.conf</code> file.</p></blockquote><blockquote><p>It is more advisable to pass <code>-mca</code> flag instead of <code>--mca</code>, even though the current openmpi version we are using recognizes it as a valid synonym. It is generally recommended to use the &quot;-mca&quot; option, rather than &quot;–mca&quot;, when running &quot;mpirun&quot; with Open MPI. This is because the &quot;-mca&quot; option is more widely recognized and documented, and is the more commonly used syntax for specifying MCA parameters. Using &quot;–mca&quot; may cause confusion for users who are not familiar with this alternative syntax, or who are using a version of Open MPI that does not support the &quot;–mca&quot; option.</p></blockquote><blockquote><p>The order in which the values are passed indicate the priority of them respectively.</p></blockquote><h2 id="Components-for-MPI-collective-communication"><a class="docs-heading-anchor" href="#Components-for-MPI-collective-communication">Components for MPI collective communication</a><a id="Components-for-MPI-collective-communication-1"></a><a class="docs-heading-anchor-permalink" href="#Components-for-MPI-collective-communication" title="Permalink"></a></h2><h3 id="basic"><a class="docs-heading-anchor" href="#basic"><code>basic</code></a><a id="basic-1"></a><a class="docs-heading-anchor-permalink" href="#basic" title="Permalink"></a></h3><blockquote><p><code>basic</code>: the default component used when not using either shared memory or self, contains at least one set of implementations per collective operation.</p></blockquote><h3 id="sm"><a class="docs-heading-anchor" href="#sm"><code>sm</code></a><a id="sm-1"></a><a class="docs-heading-anchor-permalink" href="#sm" title="Permalink"></a></h3><blockquote><p><code>sm</code>: collectives for use when Open MPI is running completely on a shared memory system</p></blockquote><h3 id="self"><a class="docs-heading-anchor" href="#self"><code>self</code></a><a id="self-1"></a><a class="docs-heading-anchor-permalink" href="#self" title="Permalink"></a></h3><blockquote><p><code>self</code>: a special feature within MPI for use on the <code>MPI_COMM_SELF</code> communicator</p></blockquote><h3 id="tuned"><a class="docs-heading-anchor" href="#tuned"><code>tuned</code></a><a id="tuned-1"></a><a class="docs-heading-anchor-permalink" href="#tuned" title="Permalink"></a></h3><blockquote><p><code>tuned</code> is an open MPI collective communications component</p></blockquote><p><strong>Design:</strong> tuned is designed with the following goals according to Fagg et al. from the university of Tennessee:</p><ol><li><p>Multiple collective implementations</p></li><li><p>Multiple logical topologies</p></li><li><p>Wide range of fully tunable parameters</p></li><li><p>Effficient default decisions</p></li><li><p>Alternative user supplied compiled decision functions</p></li><li><p>User supplied selective decision parameter configuration files</p></li><li><p>Provide a means to dynamically create/alter decision functions at runtime</p></li></ol><p>For the DPHPC project, the most important feature that we need is the 5th item, as we can make changes to the code and tune for better performance without fully replacing the current default rules.</p><p><strong>Performance:</strong></p><p><a href="https://link.springer.com/chapter/10.1007/978-0-387-69858-8_7">(Source: Fagg et al)</a></p><hr/><h1 id="MPI-Tutorial"><a class="docs-heading-anchor" href="#MPI-Tutorial">MPI Tutorial</a><a id="MPI-Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#MPI-Tutorial" title="Permalink"></a></h1><blockquote><p>Page documented some most important concepts about MPI <a href="https://mpitutorial.com/">(source)</a></p></blockquote><h2 id="Introduction-and-MPI-installation"><a class="docs-heading-anchor" href="#Introduction-and-MPI-installation">Introduction and MPI installation</a><a id="Introduction-and-MPI-installation-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-and-MPI-installation" title="Permalink"></a></h2><p><strong>Point-to-point communication:</strong> communications involve one sender and receiver.</p><p><strong>Collective communication:</strong> </p><ul><li>eg. when a manger process needs to broadcast information to all of its worker processes.</li></ul><h2 id="Blocking-point-to-point-communication"><a class="docs-heading-anchor" href="#Blocking-point-to-point-communication">Blocking point-to-point communication</a><a id="Blocking-point-to-point-communication-1"></a><a class="docs-heading-anchor-permalink" href="#Blocking-point-to-point-communication" title="Permalink"></a></h2><h3 id="Send-and-Receive"><a class="docs-heading-anchor" href="#Send-and-Receive">Send and Receive</a><a id="Send-and-Receive-1"></a><a class="docs-heading-anchor-permalink" href="#Send-and-Receive" title="Permalink"></a></h3><pre><code class="language-C hljs">MPI_Send(
    void* data,
    int count,
    MPI_Datatype datatype,
    int destination,
    int tag,
    MPI_Comm communicator)</code></pre><pre><code class="language-C hljs">MPI_Recv(
    void* data,
    int count,
    MPI_Datatype datatype,
    int source,
    int tag,
    MPI_Comm communicator,
    MPI_Status* status)</code></pre><blockquote><p>Process A decides a message needs to be sent to process B, process A packs up all of its necessary data into a buffer for process B. The buffer is called <em>envelopes</em>.</p></blockquote><blockquote><p>The communication device (often a network) is responsible for routing the message to the proper location.</p></blockquote><blockquote><p>Process B needs to acknowledge that it wants to receive A&#39;s data.</p></blockquote><blockquote><p>Tagged messages to be received by <code>MPI_Recv()</code> have priority over the messages with other tags =&gt; will be buffered</p></blockquote><h2 id="Groups-and-communicators"><a class="docs-heading-anchor" href="#Groups-and-communicators">Groups and communicators</a><a id="Groups-and-communicators-1"></a><a class="docs-heading-anchor-permalink" href="#Groups-and-communicators" title="Permalink"></a></h2><h2 id="Collective-communication"><a class="docs-heading-anchor" href="#Collective-communication">Collective communication</a><a id="Collective-communication-1"></a><a class="docs-heading-anchor-permalink" href="#Collective-communication" title="Permalink"></a></h2><p>We can classify the MPI collective operations using the following communication patterns:</p><p><strong>1. One-to-many/Many-to-one: single producer or consumer (eg. broadcast, reduce, Scatter(v), Gather(v))</strong></p><p>The data flow for this type of algorithm is unidirection. Virtual topologies can be used to determin the preceding and succeeding nodes in the algorithm.</p><ul><li><p>i). receive data from preceding nodes(s)</p></li><li><p>ii). process data, if required</p></li><li><p>iii). send data to succeeding node(s)</p></li></ul><p><strong>2. Many-to-many: every participant is both producer and consumer (eg. barrier, alltoall, Allreduce, and Allgather(v))</strong></p><p>(source: <a href="https://ieeexplore.ieee.org/document/1420226">Pjesivac-Grbovic et al.</a>)</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../algorithm/">« Algorithm</a><a class="docs-footer-nextpage" href="../trouble_shooting/">Trouble shooting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 19 December 2022 11:06">Monday 19 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
